{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>TarotMe — Reading</title>

  <!-- Bootstrap for quick layout (optional) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    /* background uses the Figma image you uploaded (local path) */
    body {
      margin: 0;
      font-family: "Georgia", serif;
      background-image: url("/mnt/data/3a6318b6-2801-4060-8085-f31828ef6925.png");
      background-size: cover;
      background-position: center;
      color: #2e2430;
    }

    .topbar {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:18px 32px;
      background: rgba(10,6,10,0.28);
      color: #fff;
    }
    .brand { font-size: 26px; font-weight:700; letter-spacing:1px; color:#fff; }
    .navlinks a { color: #eee; margin-left:18px; text-decoration:none; font-size:14px; }

    .main-wrap { max-width:1100px; margin:36px auto; display:flex; gap:28px; align-items:flex-start; padding:20px; }

    .reading-box {
      width: 420px;
      background: #efe2d3; 
      border-radius: 14px;
      padding: 26px;
      box-shadow: 0 8px 24px rgba(11,8,10,0.25);
      color: #2f2226;
    }
    .reading-box h3 { margin-top:0; font-size:20px; }

    .cards-col { width: 520px; position:relative; height:420px; display:flex; align-items:center; justify-content:center; }

    .card-container { perspective: 1200px; width: 220px; height: 350px; margin: 0 12px; display:inline-block; }
    .flip-card {
      width:100%;
      height:100%;
      position:relative;
      cursor: pointer;
    }
    .flip-card-inner {
      position: absolute;
      width:100%;
      height:100%;
      transition: transform 0.9s cubic-bezier(.2,.8,.2,1);
      transform-style: preserve-3d;
    }
    .flip-card.flipped .flip-card-inner {
      transform: rotateY(180deg);
    }
    .flip-card-front, .flip-card-back {
      position:absolute;
      top:0; left:0;
      width:100%; height:100%;
      backface-visibility: hidden;
      border-radius: 12px;
      overflow:hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    }
    .flip-card-back img, .flip-card-front img {
      width:100%; height:100%; object-fit:cover; display:block;
    }
    .flip-card-front { transform: rotateY(180deg); }

    @media (max-width: 900px) {
      .main-wrap { flex-direction: column; align-items:center; }
      .reading-box, .cards-col { width: 92%; }
      .cards-col { height: auto; padding: 24px 0; }
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="brand">TarotMe</div>
    <div class="navlinks">
      <a href="{% url 'readings:index' %}">Home</a>
      <a href="{% url 'readings:card_of_day' %}">Card of the Day</a>
      <a href="{% url 'admin:index' %}">Admin</a>
    </div>
  </div>

  <div class="main-wrap">

    <!-- Left: explanation panel (filled by backend or JS) -->
    <div class="reading-box">
      <h3 id="reading-title">Your three-card reading</h3>
      <p id="reading-text">
        {% if reading_text %}
          {{ reading_text }}
        {% else %}
          The cards will reveal a short interpretation once the reading is complete.
        {% endif %}
      </p>

      <div class="mt-3">
        <button id="expandBtn" class="btn btn-sm" style="background:#bba5b6; color:#3a2e36; border:none;">
          Expand the reading
        </button>
      </div>
    </div>

    <div class="cards-col" aria-live="polite">


      <div id="cardsRow" style="display:flex; align-items:center; justify-content:center;">
        {% comment %} Example usage:
           cards = [
             {'image': 'the_world.jpg'},
             {'image': 'knight_of_wands.jpg'},
             {'image': 'nine_of_pentacles.jpg'}
           ]
        {% endcomment %}
        {% for card in cards %}
          <div class="card-container" data-index="{{ forloop.counter0 }}">
            <div class="flip-card" data-index="{{ forloop.counter0 }}">
              <div class="flip-card-inner">
                <!-- BACK -->
                <div class="flip-card-back" aria-hidden="false">
                  <img src="{% static 'cards/CardBacks.jpg' %}" alt="card back">
                </div>
                <div class="flip-card-front" aria-hidden="true">
                  <img src="{% static 'cards/' %}{{ card.image }}" alt="{{ card.name|default:'Tarot card' }}">
                </div>
              </div>
            </div>
          </div>
        {% empty %}
          <div class="card-container">
            <div class="flip-card">
              <div class="flip-card-inner">
                <div class="flip-card-back"><img src="{% static 'cards/CardBacks.jpg' %}"></div>
                <div class="flip-card-front"><img src="{% static 'cards/the_fool.jpg' %}"></div>
              </div>
            </div>
          </div>
          <div class="card-container">
            <div class="flip-card">
              <div class="flip-card-inner">
                <div class="flip-card-back"><img src="{% static 'cards/CardBacks.jpg' %}"></div>
                <div class="flip-card-front"><img src="{% static 'cards/the_magician.jpg' %}"></div> 
              </div>
            </div>
          </div>
          <div class="card-container">
            <div class="flip-card">
              <div class="flip-card-inner">
                <div class="flip-card-back"><img src="{% static 'cards/CardBacks.jpg' %}"></div>
                <div class="flip-card-front"><img src="{% static 'cards/the_high_priestess.jpg' %}"></div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const flipDelayMs = 900;
      const flipCards = Array.from(document.querySelectorAll(".flip-card"));
      // auto flip with stagger
      flipCards.forEach((el, idx) => {
        setTimeout(() => {
          el.classList.add("flipped");
        }, flipDelayMs * (idx + 1));
      });

      flipCards.forEach(el => {
        el.addEventListener("click", () => {
          el.classList.toggle("flipped");
        });
      });

      const readingTextEl = document.getElementById("reading-text");
      const readingTitleEl = document.getElementById("reading-title");
      if (!readingTextEl.textContent.trim()) {
        const totalDelay = flipDelayMs * (flipCards.length + 1);
        setTimeout(() => {
          readingTitleEl.textContent = "Interpretation";
          readingTextEl.textContent = "The cards reveal a path forward — change and new beginnings. (AI reading will be injected by backend.)";
        }, totalDelay + 200);
      }
    });
  </script>
</body>
</html>
